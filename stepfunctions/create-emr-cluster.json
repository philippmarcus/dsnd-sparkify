{
    "Comment": "An example of the Amazon States Language for running jobs on Amazon EMR and returns then ClusterId as result.",
    "StartAt": "Create EMR cluster",
    "States": {
      "Create EMR cluster": {
        "Type": "Task",
        "Resource": "arn:aws:states:::elasticmapreduce:createCluster.sync",
        "Parameters": {
          "Name": "SparkifyCluster",
          "VisibleToAllUsers": true,
          "ReleaseLabel": "emr-6.2.0",
          "Applications": [
            { "Name": "Spark" }
          ],
          "BootstrapActions": [
            { 
               "Name": "PythonLibraries",
               "ScriptBootstrapAction": { 
                  "Path": "s3://sparkify-pmarcus/bootstrap-modules.sh"
               }
            }
           ],
          "ServiceRole": "EMR_DefaultRole",
          "JobFlowRole": "EMR_EC2_DefaultRole",
          "LogUri": "s3://stepfunctions-emrproject-272999226472-ap-southeast-1/logs/",
          "Instances": {
            "KeepJobFlowAliveWhenNoSteps": true,
            "InstanceFleets": [
              {
                "Name": "MyMasterFleet",
                "InstanceFleetType": "MASTER",
                "TargetOnDemandCapacity": 1,
                "InstanceTypeConfigs": [
                  {
                    "InstanceType": "m5.xlarge"
                  }
                ]
              },
              {
                "Name": "MyCoreFleet",
                "InstanceFleetType": "CORE",
                "TargetOnDemandCapacity": 2,
                "InstanceTypeConfigs": [
                  {
                    "InstanceType": "m5.xlarge"
                  }
                ]
              }
            ]
          }
        },
        "ResultSelector": {
          "ClusterId.$": "$.ClusterId"
        },
        "ResultPath" :  "$.ClusterId",
        
       "End": true
      }
    }
  }